#!/bin/sh

if [ "@MESON_WERROR@" = "YES" ]; then
	SPHINX_WERROR="-W"
else
	SPHINX_WERROR=""
fi

set -e

BUILDINFO_ORIG="@OUTDIR@/.buildinfo"
BUILDINFO_SAVE="@SRCDIR@/buildinfo.save"

[ -f "$BUILDINFO_SAVE" ] && mv -f "$BUILDINFO_SAVE" "$BUILDINFO_ORIG"

@DOXYGEN_CMD@ @DOXYGEN_CONF@

@SPHINX_CMD@ $SPHINX_WERROR -E -q -j auto -d @DOCTREES_DIR@ @SRCDIR@ @OUTDIR@

mv -f "$BUILDINFO_ORIG" "$BUILDINFO_SAVE"
